<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>ROMPETUTI - Phaser Web</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background-color: #000; }
    canvas { display: block; }
    #rotate-device-message {
      display: none;
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.9); color: #fff; z-index: 9999;
      text-align: center; padding-top: 40vh; font-size: 20px; font-family: sans-serif;
      box-sizing: border-box; padding: 0 10px;
    }
    #fullscreen-button {
      position: fixed; top: 10px; right: 10px; z-index: 10000;
      padding: 8px 12px; background-color: rgba(0,0,0,0.6);
      color: #fff; border: 1px solid #fff; border-radius: 5px;
      font-size: 14px; cursor: pointer; display: none;
    }
  </style>
</head>
<body>
  <div id="rotate-device-message">
    Por favor, rota tu dispositivo a modo horizontal para jugar.
  </div>
  <!-- Botón opcional para pantalla completa -->
  <button id="fullscreen-button">Pantalla Completa</button>

  <script>
  window.onload = () => {
    const rotateMessage      = document.getElementById('rotate-device-message');
    const fullscreenButton   = document.getElementById('fullscreen-button');
    let game = null;

    // Fullscreen via Phaser
    function enterFullscreen() {
      if (game && !game.scale.isFullscreen) {
        game.scale.startFullscreen();
        fullscreenButton.style.display = 'none';
      }
    }
    fullscreenButton.addEventListener('click', enterFullscreen);

    // Detecta orientación y crea/pausa el juego
    function checkOrientation() {
      const isPortrait = window.matchMedia('(orientation: portrait)').matches;

      if (isPortrait) {
        rotateMessage.style.display        = 'block';
        fullscreenButton.style.display     = 'none';
        if (game && game.scene) game.scene.pause();
        return false;
      } else {
        rotateMessage.style.display = 'none';
        if (game && game.scale && !game.scale.isFullscreen) {
          fullscreenButton.style.display = 'block';
        }
        if (!game) {
          initializeGame();
        } else {
          game.scene.resume();
        }
        return true;
      }
    }

    function initializeGame() {
      const config = {
        type: Phaser.AUTO,
        backgroundColor: '#000000',
        width: window.innerWidth,
        height: window.innerHeight,
        scale: {
          mode: Phaser.Scale.FIT,
          autoCenter: Phaser.Scale.CENTER_BOTH
        },
        scene: { preload, create, update }
      };
      game = new Phaser.Game(config);
    }

    function preload() {
      for (let i = 1; i <= 4; i++) this.load.image(`fondo${i}`, `assets/fondo${i}.png`);
      this.load.image('pantallaInicio',   'assets/pantalla_inicio.png');
      this.load.image('pantallaGameOver', 'assets/pantalla_gameover.png');
      this.load.image('rompetuti',        'assets/rompetuti.png');
      this.load.image('rompetuti2',       'assets/rompetuti2.png');
      this.load.image('inodoro',          'assets/inodoro.png');
      this.load.audio('pintura',  'assets/pintura.mp3');
      this.load.audio('nivel',    'assets/nivel.mp3');
      this.load.audio('perdiste', 'assets/perdiste.mp3');
      this.load.audio('intro',    'assets/intro.mp3');
    }

    function create() {
      // Inicialización de variables
      this.jugando     = false;
      this.gameOver    = false;
      this.cacometro   = 0;
      this.banio       = 0;
      this.puntaje     = 0;
      this.nivel       = 0;
      this.pinturas    = [];
      this.manchas     = [];
      this.dirTimer    = 0;
      this.timer       = 0;

      // Música de intro
      window.musicaIntro = this.sound.add('intro', { loop: true, volume: 0.5 });
      window.musicaIntro.play();

      // Imágenes y textos
      this.pantallaInicio = this.add.image(0, 0, 'pantallaInicio')
        .setOrigin(0).setDepth(10)
        .setDisplaySize(this.scale.width, this.scale.height);

      this.pantallaGameOver = this.add.image(0, 0, 'pantallaGameOver')
        .setOrigin(0).setDepth(10)
        .setDisplaySize(this.scale.width, this.scale.height)
        .setVisible(false);

      this.fondo = this.add.image(0, 0, 'fondo1')
        .setOrigin(0).setDepth(0)
        .setDisplaySize(this.scale.width, this.scale.height);

      this.rompetuti = this.add.sprite(this.scale.width/2, 200, 'rompetuti')
        .setDepth(1).setDisplaySize(160, 200);

      this.inodoro = this.add.sprite(this.scale.width/2, this.scale.height-60, 'inodoro')
        .setDepth(1).setDisplaySize(240, 120);

      this.graphics  = this.add.graphics().setDepth(2);
      this.cacoText  = this.add.text(10, 10, 'CACÓMETRO',     { fontSize: '20px', fill: '#fff' }).setDepth(2);
      this.banioText = this.add.text(this.scale.width-10, 10, 'BAÑO EXPLOTADO', { fontSize: '20px', fill: '#fff' })
        .setOrigin(1, 0).setDepth(2);

      // Botón de inicio
      this.startButton = this.add.text(this.scale.width/2, this.scale.height-80, 'COMENZAR PARTIDA', {
          fontSize: '32px', fill: '#fff',
          backgroundColor: '#000', padding: { x:10, y:5 }
        })
        .setOrigin(0.5).setDepth(11)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          if (!checkOrientation()) return;
          enterFullscreen();
          this.pantallaInicio.setVisible(false);
          this.startButton.setVisible(false);
          this.jugando = true;
          if (window.musicaIntro.isPlaying) window.musicaIntro.stop();
        });

      // Resize dinámico
      this.scale.on('resize', (gameSize) => {
        const w = gameSize.width, h = gameSize.height;
        this.cameras.resize(w, h);
        this.pantallaInicio.setDisplaySize(w, h);
        this.pantallaGameOver.setDisplaySize(w, h);
        this.fondo.setDisplaySize(w, h);
        this.rompetuti.setPosition(w/2, 200);
        this.inodoro.setPosition(w/2, h-60);
        this.startButton.setPosition(w/2, h-80);
        this.banioText.setPosition(w-10, 10);
        this.cacoText.setPosition(10, 10);
      }, this);
    }

    function update(time, delta) {
      if (!this.jugando || this.gameOver) return;
      // … aquí va tu lógica de movimiento, colisiones y fin de juego …
    }

    // Inicializa o pausa según orientación
    checkOrientation();
    window.addEventListener('resize', checkOrientation);
    if (window.screen.orientation) {
      window.screen.orientation.addEventListener('change', checkOrientation);
    }
  };
  </script>
</body>
</html>
